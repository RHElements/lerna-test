<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>RHElements: rh-autocomplete Demo</title>

    <noscript>
      <link href="../../rhelement/rhelement-noscript.min.css" rel="stylesheet">
    </noscript>

    <link href="../../rhelement/rhelement.min.css" rel="stylesheet">

    <!-- uncomment the es5-adapter if you're using the umd version -->
    <script src="/@webcomponents/webcomponentsjs/custom-elements-es5-adapter.js"></script>
    <script src="/@webcomponents/webcomponentsjs/webcomponents-loader.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.5/require.min.js"></script>
    <script>require([
      '../../../themes/cp-theme/cp-theme.umd.js',
      '../rh-autocomplete.umd.js'
    ])</script>
  </head>
  <body unresolved>
    <rh-autocomplete id="search-lazy-loading" init-value="uni" debounce="500"></rh-autocomplete>
    <br>
    <rh-autocomplete init-value="uni" disabled></rh-autocomplete>
    <script>
      const searchAutocomplete = document.querySelector('#search-lazy-loading');

      // autocomplete call
      searchAutocomplete.autocompleteRequest = function(params, callback) {
        var xhr = new XMLHttpRequest();
        searchAutocomplete.setAttribute('loading', '');
        xhr.onload = function() {
          searchAutocomplete.removeAttribute('loading');

          if(xhr.status === 404) {
            callback([]);
          } else {
            const response = JSON.parse(xhr.responseText);
            const regx = new RegExp("\^" + params.query, "i");

            let responseReady = response.reduce(function(acc, item) {
              if (regx.test(item.name)) acc.push(item.name);
              return acc;
            }, []);
            callback(responseReady);
          }
        };

        const url = 'https://restcountries.eu/rest/v2/name/' + params.query;

        xhr.open('GET', url, true);
        xhr.send();
      };

      // when user performs search, this event is fired
      // search phrase is passed to e.detail.searchValue
      searchAutocomplete.addEventListener('rh-search-event', function(e) {
        console.log('do search= ' + e.detail.searchValue);
      });
    </script>
  </body>
</html>
