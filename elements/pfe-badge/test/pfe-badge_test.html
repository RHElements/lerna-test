<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
    <script src="/components/@webcomponents/webcomponentsjs/webcomponents-bundle.js"></script>
    <script src="/components/web-component-tester/browser.js"></script>
    <script type="module" src="../dist/pfe-badge.js"></script>
  </head>
  <body>

    <pfe-badge number="1">1</pfe-badge>
    
    <script>
      suite('<pfe-badge>', () => {
        test('it should upgrade', () => {
          assert.instanceOf(document.querySelector('pfe-badge'), customElements.get("pfe-badge", 'pfe-badge should be an instance of pfeBadge'));
        });

        test("it should log a warning if the pfe-threshold is provided with text value", done => {
          const spy = sinon.spy(console, 'warn');
          const pfeBadge = document.createElement("pfe-badge");
          pfeBadge.setAttribute("pfe-threshold", 100);
          pfeBadge.setAttribute("text", "inprogress");
          pfeBadge.textContent = "inprogress";
          document.body.appendChild(pfeBadge);
          flush(() => {
            sinon.assert.calledWith(spy, `pfe-badge: attribute 'pfe-threshold' shouldn't be used with 'text' value`);
            spy.restore();
            done();
          });
        });

        test("it should set or reset textContent equivalent to the number attribute", () => {
          const pfeBadge = document.createElement("pfe-badge");
          pfeBadge.setAttribute("number", 100);
          pfeBadge.nodeValue = "10";
          document.body.appendChild(pfeBadge);
          assert.equal(pfeBadge.textContent, 100);
        });

        test("it should set or reset textContent equivalent to the text attribute", () => {
          const pfeBadge = document.createElement("pfe-badge");
          pfeBadge.setAttribute("text", "inprogress");
          pfeBadge.nodeValue = "10";
          document.body.appendChild(pfeBadge);
          assert.equal(pfeBadge.textContent, "inprogress");
        });

        test("it should add '+' sign if value exceeds the threshold", () => {
          const pfeBadge = document.createElement("pfe-badge");
          pfeBadge.setAttribute("number", 900);
          pfeBadge.setAttribute("pfe-threshold", 100);
          pfeBadge.nodeValue = "900";
          document.body.appendChild(pfeBadge);
          assert.equal(pfeBadge.textContent, "100+");
        });

        test("it shouldn't add a '+' sign if the value doesn't exceed the threshold", () => {
          const pfeBadge = document.createElement("pfe-badge");
          pfeBadge.setAttribute("number", 900);
          pfeBadge.setAttribute("pfe-threshold", 1000);
          pfeBadge.nodeValue = "900";
          document.body.appendChild(pfeBadge);

          assert.equal(pfeBadge.textContent, "900");
        });
      });
    </script>
  </body>
</html>
