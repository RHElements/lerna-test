{"version":3,"file":"rh-dropdown.umd.js","sources":["rh-dropdown.umd.js"],"sourcesContent":["/*\n * Copyright 2018 Red Hat, Inc.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport RHElement from \"../rhelement/rhelement.umd.js\";\nimport \"../rh-dropdown-button/rh-dropdown-button.umd.js\";\nimport \"../rh-dropdown-menu/rh-dropdown-menu.umd.js\";\n\n// https://tc39.github.io/ecma262/#sec-array.prototype.findIndex\nif (!Array.prototype.findIndex) {\n  Object.defineProperty(Array.prototype, \"findIndex\", {\n    value: function(predicate) {\n      // 1. Let O be ? ToObject(this value).\n      if (this == null) {\n        throw new TypeError('\"this\" is null or not defined');\n      }\n\n      var o = Object(this);\n\n      // 2. Let len be ? ToLength(? Get(O, \"length\")).\n      var len = o.length >>> 0;\n\n      // 3. If IsCallable(predicate) is false, throw a TypeError exception.\n      if (typeof predicate !== \"function\") {\n        throw new TypeError(\"predicate must be a function\");\n      }\n\n      // 4. If thisArg was supplied, let T be thisArg; else let T be undefined.\n      var thisArg = arguments[1];\n\n      // 5. Let k be 0.\n      var k = 0;\n\n      // 6. Repeat, while k < len\n      while (k < len) {\n        // a. Let Pk be ! ToString(k).\n        // b. Let kValue be ? Get(O, Pk).\n        // c. Let testResult be ToBoolean(? Call(predicate, T, « kValue, k, O »)).\n        // d. If testResult is true, return k.\n        var kValue = o[k];\n        if (predicate.call(thisArg, kValue, k, o)) {\n          return k;\n        }\n        // e. Increase k by 1.\n        k++;\n      }\n\n      // 7. Return -1.\n      return -1;\n    }\n  });\n}\n\n// Set up a unique ID\nconst baseID = Date.now();\n\nclass RhDropdown extends RHElement {\n  get html() {\n    return `\n<style>\n:host {\n  position: relative; }\n</style>\n<slot></slot>`;\n  }\n\n  static get tag() {\n    return \"rh-dropdown\";\n  }\n\n  get styleUrl() {\n    return \"rh-dropdown.scss\";\n  }\n\n  get templateUrl() {\n    return \"rh-dropdown.html\";\n  }\n\n  constructor() {\n    super(RhDropdown.tag);\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n\n    this.setAttribute(\"defined\", \"\");\n\n    const thisButton = this._thisButton();\n    const thisMenu = this._thisMenu();\n\n    customElements.whenDefined(\"rh-dropdown-button\").then(() => {\n      let button = thisButton.shadowRoot.querySelector(\"button\");\n      button.setAttribute(\"aria-controls\", \"rh-dropdown-\" + baseID);\n      button.setAttribute(\"id\", \"rh-dropdown-button-\" + baseID);\n    });\n    customElements.whenDefined(\"rh-dropdown-menu\").then(() => {\n      let menu = thisMenu.shadowRoot.querySelector(\"ul\");\n      menu.setAttribute(\"id\", \"rh-dropdown-\" + baseID);\n      menu.setAttribute(\"aria-labelledby\", \"rh-dropdown-button-\" + baseID);\n    });\n\n    this.addEventListener(\"rh-dropdown-change\", this._changeHandler);\n    this.addEventListener(\"rh-dropdown-close\", this._closeHandler);\n    this.addEventListener(\"keydown\", this._keydownHandler);\n    this.addEventListener(\"click\", this._clickHandler);\n  }\n\n  disconnectedCallback() {\n    this.removeEventListener(\"rh-dropdown-change\", this._changeHandler);\n    this.removeEventListener(\"rh-dropdown-close\", this._closeHandler);\n    this.removeEventListener(\"keydown\", this._keydownHandler);\n    this.removeEventListener(\"click\", this._clickHandler);\n  }\n\n  _changeHandler(evt) {\n    const rhDropdownButton = this._thisButton();\n    const rhDropdownMenu = this._thisMenu();\n\n    if (evt.detail.expanded) {\n      this._expandMenu(rhDropdownButton, rhDropdownMenu);\n    } else {\n      this._collapseMenu(rhDropdownButton, rhDropdownMenu);\n      this._focusOnButton(rhDropdownButton);\n    }\n  }\n\n  _closeHandler(evt) {\n    const rhDropdownButton = this._thisButton();\n    const rhDropdownMenu = this._thisMenu();\n    this._collapseMenu(rhDropdownButton, rhDropdownMenu);\n  }\n\n  _clickHandler(evt) {\n    const rhDropdownButton = this._thisButton();\n    const rhDropdownMenu = this._thisMenu();\n    const link = evt.composedPath()[0];\n\n    if (link.nodeName == \"A\") {\n      this._collapseMenu(rhDropdownButton, rhDropdownMenu);\n    }\n  }\n\n  _expandMenu(rhDropdownButton, rhDropdownMenu) {\n    let list = rhDropdownMenu.shadowRoot.querySelector(\"ul\");\n    rhDropdownButton.expanded = true;\n    list.removeAttribute(\"hidden\");\n    list.querySelector(\"li:first-child > a\").focus();\n  }\n\n  _collapseMenu(rhDropdownButton, rhDropdownMenu) {\n    rhDropdownButton.expanded = false;\n    rhDropdownMenu.shadowRoot\n      .querySelector(\"ul\")\n      .setAttribute(\"hidden\", \"hidden\");\n  }\n\n  _focusOnButton(rhDropdownButton) {\n    let button = rhDropdownButton.shadowRoot.querySelector(\"button\");\n    button.focus();\n  }\n\n  _thisButton() {\n    return this.querySelector(\"rh-dropdown-button\");\n  }\n\n  _thisMenu() {\n    return this.querySelector(\"rh-dropdown-menu\");\n  }\n\n  _keydownHandler(evt) {\n    const thisButton = this._thisButton();\n    let newItem,\n      flaggedKey = false,\n      pressedKey = evt.key,\n      onBtn = thisButton.shadowRoot.activeElement;\n\n    if (evt.shiftKey) {\n      if (this._isPrintableCharacter(pressedKey)) {\n        newItem = this._getLinkByFirstCharacter(pressedKey);\n      }\n    } else if (this._isPrintableCharacter(pressedKey)) {\n      newItem = this._getLinkByFirstCharacter(pressedKey);\n    } else {\n      switch (pressedKey) {\n        case \"ArrowDown\":\n        case \"Down\":\n          newItem = this._nextLink();\n          flaggedKey = true;\n          break;\n        case \"ArrowUp\":\n        case \"Up\":\n          newItem = this._previousLink();\n          flaggedKey = true;\n          break;\n        case \"Home\":\n        case \"PageUp\":\n          newItem = this._firstLink();\n          flaggedKey = true;\n          break;\n        case \"End\":\n        case \"PageDown\":\n          newItem = this._lastLink();\n          flaggedKey = true;\n          break;\n        case \" \":\n          if (!onBtn) {\n            flaggedKey = true;\n          }\n          break;\n        case \"Tab\":\n          this.dispatchEvent(\n            new CustomEvent(\"rh-dropdown-close\", {\n              detail: { expanded: false }\n            })\n          );\n          break;\n        case \"Escape\":\n          flaggedKey = true;\n          this.dispatchEvent(\n            new CustomEvent(\"rh-dropdown-change\", {\n              detail: { expanded: false }\n            })\n          );\n          return;\n        default:\n          return;\n      }\n\n      if (flaggedKey) {\n        event.stopPropagation();\n        event.preventDefault();\n      }\n    }\n\n    if (newItem && newItem != -1) {\n      newItem.querySelector(\"a\").focus();\n    }\n  }\n\n  _allLinks() {\n    const thisMenu = this._thisMenu();\n    return [...thisMenu.shadowRoot.querySelectorAll(\"li\")];\n  }\n\n  _isPrintableCharacter(str) {\n    return str.length === 1 && str.match(/\\S/);\n  }\n\n  _getIndexFirstChars(startIndex, char) {\n    const links = this._allLinks();\n    for (var i = startIndex; i < links.length; i++) {\n      let thisChar = links[i]\n        .querySelector(\"a\")\n        .innerText.charAt(0)\n        .toLowerCase();\n      if (char === thisChar) {\n        return i;\n      }\n    }\n    return -1;\n  }\n\n  _getLinkByFirstCharacter(pressedKey) {\n    const thisButton = this._thisButton();\n    let wasBtn = thisButton.shadowRoot.activeElement;\n    if (wasBtn) {\n      return;\n    }\n\n    const char = pressedKey.toLowerCase();\n    const links = this._allLinks();\n    const thisMenu = this._thisMenu();\n    let focused = thisMenu.shadowRoot.activeElement;\n    let start = links.findIndex(link => link === focused.parentElement) + 1;\n    let newIndex;\n\n    if (start === links.length) {\n      start = 0;\n    }\n\n    // Check remaining slots in the menu\n    newIndex = this._getIndexFirstChars(start, char);\n\n    // If not found in remaining slots, check from beginning\n    if (newIndex === -1) {\n      newIndex = this._getIndexFirstChars(0, char);\n    }\n\n    // If match was found...\n    if (newIndex > -1) {\n      return links[newIndex];\n    } else {\n      return -1;\n    }\n  }\n\n  _previousLink() {\n    const links = this._allLinks();\n    const thisMenu = this._thisMenu();\n    const thisButton = this._thisButton();\n    let focused = thisMenu.shadowRoot.activeElement;\n    let wasBtn = thisButton.shadowRoot.activeElement;\n    let newIndex;\n\n    if (!focused && wasBtn) {\n      // Handles tabbing off menu and back into menu.\n      newIndex = links.length - 1;\n    } else {\n      // I'm already inside the menu\n      newIndex = links.findIndex(link => link === focused.parentElement) - 1;\n    }\n\n    return links[(newIndex + links.length) % links.length];\n  }\n\n  _nextLink() {\n    const links = this._allLinks();\n    const thisMenu = this._thisMenu();\n    const thisButton = this._thisButton();\n    let focused = thisMenu.shadowRoot.activeElement;\n    let wasBtn = thisButton.shadowRoot.activeElement;\n    let newIndex;\n\n    if (!focused && wasBtn) {\n      // Handles tabbing off menu and back into menu.\n      newIndex = 0;\n    } else {\n      // I'm already inside the menu\n      newIndex = links.findIndex(link => link === focused.parentElement) + 1;\n    }\n\n    return links[newIndex % links.length];\n  }\n\n  _firstLink() {\n    const links = this._allLinks();\n    return links[0];\n  }\n\n  _lastLink() {\n    const links = this._allLinks();\n    return links[links.length - 1];\n  }\n}\n\nRHElement.create(RhDropdown);\n"],"names":["Array","prototype","findIndex","defineProperty","predicate","this","TypeError","o","Object","len","length","thisArg","arguments","k","kValue","call","baseID","Date","now","RhDropdown","tag","RHElement","setAttribute","thisButton","_thisButton","thisMenu","_thisMenu","whenDefined","then","button","shadowRoot","querySelector","menu","addEventListener","_changeHandler","_closeHandler","_keydownHandler","_clickHandler","removeEventListener","evt","rhDropdownButton","rhDropdownMenu","detail","expanded","_expandMenu","_collapseMenu","_focusOnButton","composedPath","nodeName","list","removeAttribute","focus","newItem","flaggedKey","pressedKey","key","onBtn","activeElement","shiftKey","_isPrintableCharacter","_getLinkByFirstCharacter","_nextLink","_previousLink","_firstLink","_lastLink","dispatchEvent","CustomEvent","stopPropagation","preventDefault","querySelectorAll","str","match","startIndex","char","links","_allLinks","i","innerText","charAt","toLowerCase","focused","start","link","parentElement","newIndex","_getIndexFirstChars","wasBtn","create"],"mappings":"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"}