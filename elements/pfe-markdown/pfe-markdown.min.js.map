{"version":3,"file":"pfe-markdown.min.js","sources":["_temp/pfe-markdown.js"],"sourcesContent":["/*!\n * PatternFly Elements: PfeMarkdown 1.0.0-prerelease.24\n * @license\n * Copyright 2019 Red Hat, Inc.\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n * \n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n * \n*/\n\nimport PFElement from \"../pfelement/pfelement.js\";\nimport marked from \"marked/marked.min.js\";\n\nclass PfeMarkdown extends PFElement {\n  static get version() {\n    return \"1.0.0-prerelease.24\";\n  }\n\n  get html() {\n    return `<style>:host{display:block}:host([hidden]){display:none}</style><slot></slot>`;\n  }\n\n  static get properties() {\n    return {\"on\":{\"title\":\"Context\",\"type\":\"string\",\"enum\":[\"light\",\"dark\"],\"default\":\"light\",\"prefixed\":false}};\n  }\n\n  static get slots() {\n    return {\"default\":{\"title\":\"Markdown\",\"type\":\"array\",\"namedSlot\":false,\"items\":{\"oneOf\":[{\"$ref\":\"raw\"}]}}};\n  }\n  static get tag() {\n    return \"pfe-markdown\";\n  }\n\n  get templateUrl() {\n    return \"pfe-markdown.html\";\n  }\n\n  get styleUrl() {\n    return \"pfe-markdown.scss\";\n  }\n\n  get schemaUrl() {\n    return \"pfe-markdown.json\";\n  }\n\n  get markdown() {\n    return this._markdown;\n  }\n\n  set markdown(text) {\n    if (!text) {\n      return;\n    }\n\n    this._markdown = this._unindent(text);\n    this.renderMarkdown();\n  }\n\n  constructor() {\n    super(PfeMarkdown);\n\n    this._markdown = null;\n    this._markdownRender = null;\n    this._markdownContainer = null;\n    this._observerConfig = { childList: true, subtree: true };\n    this._readyStateChangeHandler = this._readyStateChangeHandler.bind(this);\n\n    this.observer = new MutationObserver((mutationList, observer) => {\n      if (!this._markdownContainer.textContent) {\n        this._markdownRender.innerHTML = \"\";\n        return;\n      }\n\n      // TODO: when we stop supporting IE11, the need to disconnect and\n      // then reconnect will no longer be needed\n      observer.disconnect();\n      this.markdown = this._markdownContainer.textContent;\n      this._muationObserve();\n    });\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n\n    this._markdownRender = document.createElement(\"div\");\n    this._markdownRender.setAttribute(\"pfe-markdown-render\", \"\");\n    this.appendChild(this._markdownRender);\n\n    this.shadowRoot.querySelector(\"slot\").addEventListener(\"slotchange\", () => {\n      if (!this._markdownContainer) {\n        this._markdownContainer = this.querySelector(\"[pfe-markdown-container]\");\n        this._markdownContainer.style.display = \"none\";\n\n        this._init();\n      }\n    });\n  }\n\n  disconnectedCallback() {\n    this.observer.disconnect();\n  }\n\n  _readyStateChangeHandler(event) {\n    if (event.target.readyState === \"complete\") {\n      document.removeEventListener(\"readystatechange\", this._readyStateChangeHandler);\n      this._init();\n    }\n  }\n\n  _init() {\n    if (this._markdownContainer.textContent) {\n      this.markdown = this._markdownContainer.textContent;\n    }\n\n    this._muationObserve();\n  }\n\n  renderMarkdown() {\n    this._markdownRender.innerHTML = marked(this.markdown);\n  }\n\n  _muationObserve() {\n    this.observer.observe(this._markdownContainer, this._observerConfig);\n  }\n\n  // pulled from https://github.com/PolymerElements/marked-element/blob/master/marked-element.js#L340\n  _unindent(text) {\n    if (!text) {\n      return text;\n    }\n\n    const lines = text.replace(/\\t/g, \"  \").split(\"\\n\");\n    const indent = lines.reduce(function(prev, line) {\n      if (/^\\s*$/.test(line)) {\n        return prev; // Completely ignore blank lines.\n      }\n\n      const lineIndent = line.match(/^(\\s*)/)[0].length;\n\n      if (prev === null) {\n        return lineIndent;\n      }\n\n      return lineIndent < prev ? lineIndent : prev;\n    }, null);\n\n    return lines\n      .map(function(l) {\n        return l.substr(indent);\n      })\n      .join(\"\\n\");\n  }\n}\n\nPFElement.create(PfeMarkdown);\n\nexport default PfeMarkdown;\n"],"names":["PfeMarkdown","PFElement","version","html","properties","on","title","type","enum","default","prefixed","slots","namedSlot","items","oneOf","$ref","tag","templateUrl","styleUrl","schemaUrl","markdown","this","_markdown","text","_unindent","renderMarkdown","[object Object]","super","_markdownRender","_markdownContainer","_observerConfig","childList","subtree","_readyStateChangeHandler","bind","observer","MutationObserver","mutationList","textContent","disconnect","_muationObserve","innerHTML","connectedCallback","document","createElement","setAttribute","appendChild","shadowRoot","querySelector","addEventListener","style","display","_init","event","target","readyState","removeEventListener","marked","observe","lines","replace","split","indent","reduce","prev","line","test","lineIndent","match","length","map","l","substr","join","create"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;EA4BA,MAAMA,UAAoBC,EACxBC,qBACE,MAAO,sBAGTC,WACE,MAAO,gFAGTC,wBACE,MAAO,CAACC,GAAK,CAACC,MAAQ,UAAUC,KAAO,SAASC,KAAO,CAAC,QAAQ,QAAQC,QAAU,QAAQC,UAAW,IAGvGC,mBACE,MAAO,CAACF,QAAU,CAACH,MAAQ,WAAWC,KAAO,QAAQK,WAAY,EAAMC,MAAQ,CAACC,MAAQ,CAAC,CAACC,KAAO,WAEnGC,iBACE,MAAO,eAGTC,kBACE,MAAO,oBAGTC,eACE,MAAO,oBAGTC,gBACE,MAAO,oBAGTC,eACE,OAAOC,KAAKC,UAGdF,aAAaG,GACNA,IAILF,KAAKC,UAAYD,KAAKG,UAAUD,GAChCF,KAAKI,kBAGPC,cACEC,MAAM3B,GAENqB,KAAKC,UAAY,KACjBD,KAAKO,gBAAkB,KACvBP,KAAKQ,mBAAqB,KAC1BR,KAAKS,gBAAkB,CAAEC,WAAW,EAAMC,SAAS,GACnDX,KAAKY,yBAA2BZ,KAAKY,yBAAyBC,KAAKb,MAEnEA,KAAKc,SAAW,IAAIC,iBAAiB,CAACC,EAAcF,KAC7Cd,KAAKQ,mBAAmBS,aAO7BH,EAASI,aACTlB,KAAKD,SAAWC,KAAKQ,mBAAmBS,YACxCjB,KAAKmB,mBARHnB,KAAKO,gBAAgBa,UAAY,KAYvCf,oBACEC,MAAMe,oBAENrB,KAAKO,gBAAkBe,SAASC,cAAc,OAC9CvB,KAAKO,gBAAgBiB,aAAa,sBAAuB,IACzDxB,KAAKyB,YAAYzB,KAAKO,iBAEtBP,KAAK0B,WAAWC,cAAc,QAAQC,iBAAiB,aAAc,KAC9D5B,KAAKQ,qBACRR,KAAKQ,mBAAqBR,KAAK2B,cAAc,4BAC7C3B,KAAKQ,mBAAmBqB,MAAMC,QAAU,OAExC9B,KAAK+B,WAKX1B,uBACEL,KAAKc,SAASI,aAGhBb,yBAAyB2B,GACS,aAA5BA,EAAMC,OAAOC,aACfZ,SAASa,oBAAoB,mBAAoBnC,KAAKY,0BACtDZ,KAAK+B,SAIT1B,QACML,KAAKQ,mBAAmBS,cAC1BjB,KAAKD,SAAWC,KAAKQ,mBAAmBS,aAG1CjB,KAAKmB,kBAGPd,iBACEL,KAAKO,gBAAgBa,UAAYgB,EAAOpC,KAAKD,UAG/CM,kBACEL,KAAKc,SAASuB,QAAQrC,KAAKQ,mBAAoBR,KAAKS,iBAItDJ,UAAUH,GACR,IAAKA,EACH,OAAOA,EAGT,MAAMoC,EAAQpC,EAAKqC,QAAQ,MAAO,MAAMC,MAAM,MACxCC,EAASH,EAAMI,OAAO,SAASC,EAAMC,GACzC,GAAI,QAAQC,KAAKD,GACf,OAAOD,EAGT,MAAMG,EAAaF,EAAKG,MAAM,UAAU,GAAGC,OAE3C,OAAa,OAATL,EACKG,EAGFA,EAAaH,EAAOG,EAAaH,GACvC,MAEH,OAAOL,EACJW,IAAI,SAASC,GACZ,OAAOA,EAAEC,OAAOV,KAEjBW,KAAK,OAIZxE,EAAUyE,OAAO1E"}