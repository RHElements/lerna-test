@import "../../pfe-sass/pfe-sass";

$LOCAL: accordion;

/// ===========================================================================
/// DEFAULT ACCORDION HEADING
/// ===========================================================================

:host {
  --pfe-accordion__header--BorderRightColor: transparent;
  --pfe-accordion__header--BorderTop:    0;
  --pfe-accordion__header--BorderBottom: 0;

  --pfe-accordion__header--TextDecoration: none;
  --pfe-accordion__header--spacer: calc(#{pfe-var(container-spacer)} * 1.5);

  display: block;

  > * {
    margin: 0;
  }

  button {
    -webkit-appearance: button;

    margin: 0;
    width: 100%;
    height: auto;
    z-index: 1;

    position: relative;
    display: block;

    font-family: inherit;
    font-weight: #{pfe-var(font-weight--bold)};
    font-size:   calc(#{pfe-var(font-size)} * 1.1);
    line-height: #{pfe-var(line-height)};
    text-align: left;
    cursor: pointer;

    color: #{pfe-radio(color--text)};
    background-color: #{pfe-local(BackgroundColor)};

    border-top:       #{pfe-local($cssvar: BorderTop, $region: header)};
    border-right:     #{pfe-var(surface--border-width)} #{pfe-var(surface--border-style)} #{pfe-local($cssvar: BorderRightColor, $region: header)};
    border-bottom:    #{pfe-local($cssvar: BorderBottom, $region: header)};
    border-left:      #{pfe-var(surface--border-width--heavy)} #{pfe-var(surface--border-style)} #{pfe-local(accent)};

    padding: #{pfe-var(container-spacer)} 50px #{pfe-var(container-spacer)} #{pfe-local($cssvar: spacer, $region: header)};
    text-decoration: #{pfe-local($cssvar: TextDecoration, $region: header)};

    &:hover,
    &:focus {
      outline: none;
      z-index: 2;
    }

    &:focus {
      --pfe-accordion__header--TextDecoration: underline;
      --pfe-accordion--accent: #{pfe-color(surface--lightest--link)};
    }

    &::after {
      content: "";
      position: absolute;
      top: calc(50% - .2em);
      right: #{pfe-local($cssvar: spacer, $region: header)};

      transition: transform 0.15s;
      transform: rotate(45deg);
      
      display: block;
      height: .4em;
      width:  .4em;

      text-align: center;

      border-style: #{pfe-var(surface--border-style)};
      border-width: .1em .1em 0 0;
      border-bottom: 0;
    }

    &::-moz-focus-inner {
        border: 0;
    }

    &[aria-expanded="true"] {
      --pfe-accordion__header--BorderRightColor: #{pfe-color(surface--border)};
      --pfe-accordion__header--BorderBottom: 0;

      &::after {
        transform: rotate(-45deg);
      }
    }
  }
}

:host(.animating) {
  transition: transform 0.3s #{pfe-var(animation-timing)};
}

:host(:hover),
:host([aria-expanded="true"]),
:host(.animating) {
  --pfe-accordion--accent: #{pfe-color(surface--lightest--link)};
}

:host(:first-child:not([pfe-border-collapse*="top"])) button {
  --pfe-accordion__header--BorderTop: #{pfe-var(surface--border-width)} #{pfe-var(surface--border-style)} #{pfe-color(surface--border)};
}

// Only show the bottom border after animation is complete
:host(:not(.animating)),
// Add border bottom to the last button in an accordion set.
:host(:last-of-type:not([pfe-border-collapse*="bottom"])) button[aria-expanded="false"] {
  --pfe-accordion__header--BorderBottom: #{pfe-var(surface--border-width)} #{pfe-var(surface--border-style)} #{pfe-color(surface--border)};
}

:host([pfe-border-collapse*="bottom"]:last-of-type) {
  --pfe-accordion__header--BorderBottom: 0;
}

:host([on="dark"]:hover),
:host([on="dark"][aria-expanded="true"]),
:host([on="dark"].animating) {
  --pfe-accordion--accent: #{pfe-color(surface--lightest)};
}

:host([on="dark"][aria-expanded="true"]) {
  --pfe-accordion--accent: #{pfe-color(surface--lightest)};
  --pfe-accordion--BackgroundColor: #{pfe-color(surface--darker)};
  --pfe-broadcasted--color--text:               #{pfe-color(text--on-dark)};
  --pfe-broadcasted--color--ui-link:            #{pfe-color(ui-link--on-dark)};
  --pfe-broadcasted--color--ui-link--visited:   #{pfe-color(ui-link--on-dark--visited)};
  --pfe-broadcasted--color--ui-link--hover:     #{pfe-color(ui-link--on-dark--hover)};
  --pfe-broadcasted--color--ui-link--focus:     #{pfe-color(ui-link--on-dark--focus)};
}
